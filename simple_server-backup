#!/bin/bash

# add name of server you want to backup as first option when running script.
# ex. "./simple_server-backup game" will output "game_backup_(current date).tar.gz"

# ensure you mount all partitions or backup will not complete
# add folders you dont want backedup in list below

echo "starting backup"

date=$(date '+%Y-%m-%d')


sudo tar czf /mnt/Media/"$1_backup_$date.tar.gz" \
    --exclude=/dev \
    --exclude=/mnt \
    --exclude=/proc \
    --exclude=/sys \
    --exclude=/tmp \
    --exclude=/media \
    --exclude=/lost+found \
    --exclude=/home/torrent/docker_torrents/mnt \
    /

#deletes backup older than 3 months
find /mnt/backup/*.tar.gz -mmin +131400 -delete

chmod 744 /mnt/backup/*.tar.gz

echo "backup complete"
